@using kajiApp_blazor.Components.Models.OptionModel
@using kajiApp_blazor.Components.DatabaseContext.OptionDBC

<table class="table table-bordered table-dark">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>名前</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var n in NameMaster)
        {
            <tr>
                <td>@n.Id</td>
                <td>@n.Name</td>
            </tr>
        }
    </tbody>
</table>

<h3 class="mt-3">名前リスト挿入</h3>
<form @onsubmit="RegisterName">
    <table class="table table-bordered table-dark">
        <thead>
            <tr>
                <th>名前</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><InputText @bind-Value="newName.Name" class="form-control" /></td>
            </tr>
        </tbody>
    </table>
    <button type="submit" class="btn btn-primary">名前登録</button>
</form>


@code {
    [Parameter] public List<NameMasterList> NameMaster { get; set; } = new();
    private NameMasterList newName = new();
    [Inject] private AppState AppState { get; set; } = default!;
    private bool isLoading = false;

    private async Task RegisterName()
    {
        try
        {
            isLoading = true;
            await new NameMaster().InsertNameMasterAsync(newName);
            Console.WriteLine("データを登録しました");
            AppState.NotifyStateChanged();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"データ登録中にエラーが発生しました: {ex.Message}");
        }
        finally
        {
            isLoading = false;
            await InvokeAsync(StateHasChanged);
        }
    }
}